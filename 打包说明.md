# Server Monitor 打包说明

## 问题修复

已修复以下问题：
1. ✅ **控制台窗口闪烁问题** - 在程序启动时立即隐藏控制台窗口
2. ✅ **程序崩溃循环** - 添加了完整的错误处理和日志记录
3. ✅ **WMI 初始化失败** - 改为延迟初始化，失败不影响程序运行
4. ✅ **Flask 启动失败** - 添加端口检测和错误处理
5. ✅ **配置文件路径** - 修复打包后配置文件路径问题
6. ✅ **托盘图标失败** - 添加错误处理，失败不影响主程序

## 打包步骤

### 1. 安装依赖

```bash
pip install flask gputil py-cpuinfo wmi pypiwin32 pyautogui pillow customtkinter pystray psutil pyinstaller -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### 2. 使用 PyInstaller 打包

```bash
pyinstaller ServerMonitor_V1.1.spec
```

或者直接使用命令：

```bash
pyinstaller --name=ServerMonitor --onefile --windowed --icon=favicon.ico --add-data "icon.png;." monitor.py
```

### 3. 检查打包结果

打包完成后，可执行文件位于 `dist/ServerMonitor_V1.1.exe`（或根据你的 spec 文件名）

## 重要说明

1. **日志文件**：程序运行时会生成 `monitor.log` 文件，如果程序出现问题，请查看此文件
2. **配置文件**：程序会在可执行文件同目录下创建 `config.json` 文件
3. **控制台隐藏**：打包时确保 `console=False`，程序启动时会自动隐藏控制台窗口
4. **端口占用**：如果 5000 端口被占用，程序会自动尝试 5001-5009 端口

## 测试建议

1. 先在不打包的情况下运行 `python monitor.py`，确保程序正常
2. 检查是否有错误信息输出
3. 打包后运行，检查 `monitor.log` 文件确认启动状态
4. 如果仍有问题，查看日志文件中的错误信息

## 常见问题

### Q: 程序启动后立即退出？
A: 查看 `monitor.log` 文件，找到具体的错误信息。可能是缺少某些依赖库。

### Q: 控制台窗口仍然出现？
A: 确保 spec 文件中 `console=False`，并且代码中的控制台隐藏代码已执行。

### Q: 托盘图标不显示？
A: 检查是否有 `icon.png` 文件，如果没有会自动创建默认图标。查看日志文件确认具体错误。

### Q: Flask 服务器无法启动？
A: 检查端口是否被占用，程序会自动尝试其他端口。查看日志文件确认使用的端口号。

